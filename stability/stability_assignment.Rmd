---
title: "Stability Assignment"
author: "Mia Guarnieri, Lauren Harris"
date: "2023-06-08"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Packages
```{r}
library(here)
library(tidyverse)
```

Source function
```{r}
source(here("stability", "lotvmodK.R"))
```

Definition of stability: a population that has a positive or 0 derivative (growth) and has a population size above or equal to the initial population size after 10 years

Test the function
```{r}
# given some characteristics - lets look at derivatives under different harvest rates
pars = list(rprey=0.95, alpha=0.01, eff=0.6,pmort=0.4, K=2000, harvest = 20)
pop = list(prey = 100, pred = 10)
# look at the derivative over a range of forest sizes
findstable = data.frame(thresh=seq(from=10, to=150, by=1))
# notice use of Time=NULL, and map to compute derivative
# for different values of forest biomass
findstable$dprey = unlist(findstable$thresh %>% map(~lotvmodK(pars=pars, t=NULL, pop=pop, thresh = .x)))[[1]]

findstable$dpred = unlist(findstable$thresh %>% map(~lotvmodK(pars=pars, t=NULL, pop=pop, thresh = .x)))[[2]]

# test out min and max in function
lotvmodK(pars=pars, t=NULL, pop=pop, thresh = min(findstable))
lotvmodK(pars=pars, t=NULL, pop=pop, thresh = max(findstable))
```

```{r}
findstable = data.frame(harvest=seq(from=0, to=100, by=5))

```

Test the function (try 2)
```{r}
# given some characteristics - lets look at derivatives under different harvest rates
pars = list(rprey=0.95, alpha=0.01, eff=0.6,pmort=0.4, K=2000, harvest = 20)
pop = list(prey = 100, pred = 10)
# look at the derivative over a range of forest sizes
findstable = data.frame(thresh=seq(from=10, to=150, by=1))

days <- seq(from = 1, to = 30)

# notice use of Time=NULL, and map to compute derivative
# for different values of forest biomass
findstable$dprey = unlist(findstable$thresh %>% map(~lotvmodK(pars=pars, t=days, pop=pop, thresh = .x)))[[1]]

findstable$dpred = unlist(findstable$thresh %>% map(~lotvmodK(pars=pars, t=days, pop=pop, thresh = .x)))[[2]]
```